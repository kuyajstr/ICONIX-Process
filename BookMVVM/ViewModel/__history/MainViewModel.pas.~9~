unit MainViewModel;

interface

uses
  ViewModelIntf, Generics.Collections, Book,
  MVCFramework.RESTClient;

type
  TMainViewModel = class(TInterfacedObject, IViewModel)
  private
    FBookList: TList<TBook>;
    FSelectedBook: TBook;
    FRestClient: IMVCRESTClient;
  public
    constructor Create;

    property BookList: TList<TBook> read FBookList write FBookList;
    property SelectedBook: TBook read FSelectedBook write FSelectedBook;

    procedure LoadBooks;

  end;

implementation

uses
  AuthService;

{ TMainViewModel }

constructor TMainViewModel.Create;
begin
  inherited Create;
  FBookList := TList<TBook>.Create;
  FRestClient := TMVCRESTClient.New.BaseURL('localhost',8080);
  FRestClient.SetBasicAuthorization('Admin','admin');

  FRestClient.Async(
    procedure(Resp: IMVCRESTResponse)
    begin
      var Token: string := Resp.ToJSONObject.Values['token'];
      TAuthService.GetInstance.SetToken(Token);
      FRestClient.SetBearerAuthorization(TAuthService.GetInstance.GetToken)
    end, nil, True).Get('/api/login');
end;

procedure TMainViewModel.LoadBooks;
begin

end;

end.
